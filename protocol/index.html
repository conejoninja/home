<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Protocol - Home Automation project</title>
    <meta name="generator" content="Hugo 0.21" />

    
    <meta name="description" content="Home Automation system.">
    
    <link rel="canonical" href="https://conejoninja.github.io/home/protocol/">
    
    <meta name="author" content="conejoninja">
    

    <meta property="og:url" content="https://conejoninja.github.io/home/protocol/">
    <meta property="og:title" content="Home Automation project">
    <meta property="og:image" content="https://conejoninja.github.io/home/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Home Automation project">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://conejoninja.github.io/home/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://conejoninja.github.io/home/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://conejoninja.github.io/home/fonts/icon.eot');
        src: url('https://conejoninja.github.io/home/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://conejoninja.github.io/home/fonts/icon.woff')
               format('woff'),
             url('https://conejoninja.github.io/home/fonts/icon.ttf')
               format('truetype'),
             url('https://conejoninja.github.io/home/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://conejoninja.github.io/home/stylesheets/application.css">
    <link rel="stylesheet" href="https://conejoninja.github.io/home/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://conejoninja.github.io/home/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://conejoninja.github.io/home/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://conejoninja.github.io/home/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-blue-grey palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Protocol
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/conejoninja" title="@conejoninja on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/conejoninja/home" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://conejoninja.github.io/home/images/logo.png">
        </div>
      
      <div class="name">
        <strong>Home Automation project <span class="version">1.0.0</span></strong>
        
          <br>
          conejoninja/home
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/conejoninja/home/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/conejoninja/home/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  




<a  title="Home" href="/home/">
	
	Home
</a>



  
</li>



<li>
  




<a  title="Devices" href="/home/devices/">
	
	Devices
</a>



  
    <ul>
      
        
        




<a  title="Rabbit food dispenser" href="/home/devices/food01/">
	
	Rabbit food dispenser
</a>



      
    </ul>
  
</li>



<li>
  




<a class="current" title="Protocol" href="/home/protocol/">
	
	Protocol
</a>


<ul id="scrollspy">
</ul>


  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          

          
          <li>
            <a href="https://github.com/conejoninja" target="_blank" title="@conejoninja on GitHub">
              @conejoninja on GitHub
            </a>
          </li>
          

          
          <li>
            <a href="mailto:conejo@conejo.me" title="Email of conejo@conejo.me">
              Contact via email
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Protocol </h1>

			

<p>Simple protocol to discover and communicate with IoT devices on a network. The devices communicate with each other through the same central server(s) (a single server or a mesh), that may or may not be in the same local network. This makes possible the communication of devices in different physical networks.</p>

<h2 id="discovery-of-devices">Discovery of devices</h2>

<p>Devices that join the network will broadcast their description. The message will be send to the <strong>discovery</strong> channel.</p>

<h3 id="discovery-message-structure">Discovery message structure</h3>

<pre><code class="language-json">ID: Unique ID of the device (e.g. temp-31415)
Name: Name of the device (e.g. ACME Temperature Sensor)
Version: Version of the protocol the device is using
Date: Optional field to force the date of the message
Out[] : Array of data types the device publish to their channel
    ID: Unique ID of the sensor (e.g. t1)
    Name: Name of the data (e.g. temperature)
    Type: Primitive type (number, text, complex object....). Default type is number, so we could save some data.
    Min? Max? : Optional fields yet to be defined in case we want to better represent them?
Methods[] : Array of methods available to communicate with the device
    Name: Method’s name (e.g. setColor, On, Off,...)
    Params[]: Array of parameters for the method
        Name: Param’s id/name
        Type: Primitive type (number, text,....). Default type is number, so we could save some data.
        Min? Max?: Optional limits to the value
</code></pre>

<h3 id="short-discovery-message-handshake">Short Discovery Message / Handshake</h3>

<p>To avoid polluting discovery channel with devices that frequently enter sleep mode or that reconnect to the network several times, devices may send only their ID to the discovery channel, then it may be asked to publish the full discovery message by sending the message “whoareyou” to “{ID}-events” channel</p>

<h2 id="sensor-information-messages">Sensor information messages</h2>

<p>A device could publish their sensor data to their own channel {ID}. A message could be composed of the data of one or more sensors, in an array.</p>

<pre><code class="language-json">[]{
    ID: Sensor’s ID (e.g. t1)
    Value: Value of the sensor (e.g. 27.4)
    Unit?: If any (e.g. “ºC”)
    Date?: Optional field to force the date of the message
}
</code></pre>

<p>Example:</p>

<pre><code class="language-json">[
    {ID: “t1”, value: 27.4, unit: “ºC”}, // temperature 
    {ID: “h1”, value: 54, unit: “%”} // humidity
]
</code></pre>

<h2 id="method-calling-messages">Method calling messages</h2>

<p>To control the devices, we could call the methods described in their discovery message on the channel <strong>{device_id}-call</strong>. A message could have one or more calls to different methods in the same message.</p>

<pre><code class="language-json">[]{
    Name: Method’s name (e.g. On)
    Parameters?: Parameters of the method (optional)
}
</code></pre>

<h2 id="general-event-channel">General Event Channel</h2>

<p>Devices should be able to emit events to the <strong>events</strong> channel,  to communicate messages not related to the sensor data. For example, if a required action failed, resulted in success or when it ended.</p>

<pre><code class="language-json">ID: Unique ID of the device (emitter) (e.g. temp-31415)
Message: Text of the message (e.g. “Task ended at @ and lasted @”)
Priority: 0 (OK), 1 (WARNING), 2 (ERROR)
Extra[]: {
    Key: Name of the data (e.g. duration)
    Value: Data (e.g. 1m35s)
}
Date?: Optional field to force the date of the message
</code></pre>


			<aside class="copyright" role="note">
				
				&copy; 2017 Released under the MIT license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://conejoninja.github.io/home/devices/food01/" title="Rabbit food dispenser">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Rabbit food dispenser
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://conejoninja.github.io/home/" title="Home Automation project">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Home Automation project
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/conejoninja.github.io\/home\/';
      var repo_id  = 'conejoninja\/home';
    
    </script>

    <script src="https://conejoninja.github.io/home/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');
      console.log("SCROLLSPY", scrollspy);
      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

